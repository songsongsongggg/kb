2022-07-14 21:00:10.717 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.1.6.Final
2022-07-14 21:00:10.979 INFO  com.song.kb.config.KbApplication                  :55   [32m                  [0;39m Starting KbApplication using Java 1.8.0_321 on yiyideMacBook-Air.local with PID 41917 (/Users/yiyi/IdeaProjects/Wiki/kb/target/classes started by yiyi in /Users/yiyi/IdeaProjects/Wiki/kb)
2022-07-14 21:00:10.981 INFO  com.song.kb.config.KbApplication                  :660  [32m                  [0;39m No active profile set, falling back to default profiles: default
2022-07-14 21:00:11.583 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2022-07-14 21:00:11.584 INFO  o.s.b.d.env.DevToolsPropertyDefaultsPostProcessor :255  [32m                  [0;39m For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2022-07-14 21:00:17.269 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :250  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2022-07-14 21:00:17.277 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :128  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2022-07-14 21:00:17.351 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :188  [32m                  [0;39m Finished Spring Data repository scanning in 28 ms. Found 0 Redis repository interfaces.
2022-07-14 21:00:21.179 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8081 (http)
2022-07-14 21:00:21.197 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8081"]
2022-07-14 21:00:21.199 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2022-07-14 21:00:21.200 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.39]
2022-07-14 21:00:21.476 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2022-07-14 21:00:21.479 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :289  [32m                  [0;39m Root WebApplicationContext: initialization completed in 9892 ms
2022-07-14 21:00:26.448 INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor  :181  [32m                  [0;39m Initializing ExecutorService 'applicationTaskExecutor'
2022-07-14 21:00:28.729 INFO  o.s.scheduling.concurrent.ThreadPoolTaskScheduler :181  [32m                  [0;39m Initializing ExecutorService 'taskScheduler'
2022-07-14 21:00:29.056 INFO  o.s.b.d.autoconfigure.OptionalLiveReloadServer    :58   [32m                  [0;39m LiveReload server is running on port 35729
2022-07-14 21:00:29.256 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8081"]
2022-07-14 21:00:29.379 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8081 (http) with context path ''
2022-07-14 21:00:29.462 INFO  com.song.kb.config.KbApplication                  :61   [32m                  [0;39m Started KbApplication in 22.321 seconds (JVM running for 27.664)
2022-07-14 21:00:29.477 INFO  com.song.kb.config.KbApplication                  :25   [32m                  [0;39m 启动成功
2022-07-14 21:00:29.478 INFO  com.song.kb.config.KbApplication                  :26   [32m                  [0;39m 地址:	http://127.0.0.1:8081
2022-07-14 21:00:35.005 INFO  com.song.kb.job.DocJob                            :32   [32m202771257115152384[0;39m 更新电子书下的文档数据开始
2022-07-14 21:00:35.084 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m202771257115152384[0;39m HikariPool-1 - Starting...
2022-07-14 21:00:37.870 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m202771257115152384[0;39m HikariPool-1 - Start completed.
2022-07-14 21:00:37.892 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771257115152384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:00:37.957 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771257115152384[0;39m ==> Parameters: 
2022-07-14 21:00:38.023 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771257115152384[0;39m <==    Updates: 5
2022-07-14 21:00:38.108 INFO  com.song.kb.job.DocJob                            :35   [32m202771257115152384[0;39m 更新电子书下的文档数据结束，耗时：3102毫秒
2022-07-14 21:01:00.006 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202771361981140992[0;39m 生成今日电子书快照开始
2022-07-14 21:01:00.031 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771361981140992[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:01:00.034 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771361981140992[0;39m ==> Parameters: 
2022-07-14 21:01:00.069 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771361981140992[0;39m <==    Updates: 0
2022-07-14 21:01:00.071 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202771361981140992[0;39m 生成今日电子书快照结束，耗时：64毫秒
2022-07-14 21:01:05.007 INFO  com.song.kb.job.DocJob                            :32   [32m202771382956855296[0;39m 更新电子书下的文档数据开始
2022-07-14 21:01:05.025 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771382956855296[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:01:05.028 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771382956855296[0;39m ==> Parameters: 
2022-07-14 21:01:05.065 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771382956855296[0;39m <==    Updates: 5
2022-07-14 21:01:05.066 INFO  com.song.kb.job.DocJob                            :35   [32m202771382956855296[0;39m 更新电子书下的文档数据结束，耗时：58毫秒
2022-07-14 21:01:35.004 INFO  com.song.kb.job.DocJob                            :32   [32m202771508773392384[0;39m 更新电子书下的文档数据开始
2022-07-14 21:01:35.036 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771508773392384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:01:35.038 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771508773392384[0;39m ==> Parameters: 
2022-07-14 21:01:35.073 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771508773392384[0;39m <==    Updates: 5
2022-07-14 21:01:35.074 INFO  com.song.kb.job.DocJob                            :35   [32m202771508773392384[0;39m 更新电子书下的文档数据结束，耗时：63毫秒
2022-07-14 21:02:00.009 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202771613647769600[0;39m 生成今日电子书快照开始
2022-07-14 21:02:00.038 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771613647769600[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:02:00.053 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771613647769600[0;39m ==> Parameters: 
2022-07-14 21:02:00.095 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771613647769600[0;39m <==    Updates: 0
2022-07-14 21:02:00.096 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202771613647769600[0;39m 生成今日电子书快照结束，耗时：85毫秒
2022-07-14 21:02:05.002 INFO  com.song.kb.job.DocJob                            :32   [32m202771634594123776[0;39m 更新电子书下的文档数据开始
2022-07-14 21:02:05.023 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771634594123776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:02:05.032 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771634594123776[0;39m ==> Parameters: 
2022-07-14 21:02:05.068 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771634594123776[0;39m <==    Updates: 5
2022-07-14 21:02:05.069 INFO  com.song.kb.job.DocJob                            :35   [32m202771634594123776[0;39m 更新电子书下的文档数据结束，耗时：65毫秒
2022-07-14 21:02:35.002 INFO  com.song.kb.job.DocJob                            :32   [32m202771760423243776[0;39m 更新电子书下的文档数据开始
2022-07-14 21:02:35.020 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771760423243776[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:02:35.021 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771760423243776[0;39m ==> Parameters: 
2022-07-14 21:02:35.055 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771760423243776[0;39m <==    Updates: 5
2022-07-14 21:02:35.056 INFO  com.song.kb.job.DocJob                            :35   [32m202771760423243776[0;39m 更新电子书下的文档数据结束，耗时：53毫秒
2022-07-14 21:03:00.003 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202771865285038080[0;39m 生成今日电子书快照开始
2022-07-14 21:03:00.022 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771865285038080[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:03:00.024 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771865285038080[0;39m ==> Parameters: 
2022-07-14 21:03:00.059 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202771865285038080[0;39m <==    Updates: 0
2022-07-14 21:03:00.060 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202771865285038080[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-07-14 21:03:05.006 INFO  com.song.kb.job.DocJob                            :32   [32m202771886269140992[0;39m 更新电子书下的文档数据开始
2022-07-14 21:03:05.024 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771886269140992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:03:05.025 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771886269140992[0;39m ==> Parameters: 
2022-07-14 21:03:05.060 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202771886269140992[0;39m <==    Updates: 5
2022-07-14 21:03:05.061 INFO  com.song.kb.job.DocJob                            :35   [32m202771886269140992[0;39m 更新电子书下的文档数据结束，耗时：54毫秒
2022-07-14 21:03:35.006 INFO  com.song.kb.job.DocJob                            :32   [32m202772012098260992[0;39m 更新电子书下的文档数据开始
2022-07-14 21:03:35.037 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772012098260992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:03:35.039 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772012098260992[0;39m ==> Parameters: 
2022-07-14 21:03:35.075 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772012098260992[0;39m <==    Updates: 5
2022-07-14 21:03:35.076 INFO  com.song.kb.job.DocJob                            :35   [32m202772012098260992[0;39m 更新电子书下的文档数据结束，耗时：64毫秒
2022-07-14 21:03:38.644 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2022-07-14 21:03:38.646 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2022-07-14 21:03:38.659 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 13 ms
2022-07-14 21:03:38.930 INFO  com.song.kb.websocket.WebSocketServer             :32   [32m                  [0;39m 有新连接：token：uHqI4lhio1NM7ogeABKjIA9u，session id：0，当前连接数：1
2022-07-14 21:03:38.973 INFO  com.song.kb.aspect.LogAspect                      :53   [32m202772028686733312[0;39m ------------- 开始 -------------
2022-07-14 21:03:38.973 INFO  com.song.kb.aspect.LogAspect                      :53   [32m202772028686733313[0;39m ------------- 开始 -------------
2022-07-14 21:03:38.974 INFO  com.song.kb.aspect.LogAspect                      :53   [32m202772028695121920[0;39m ------------- 开始 -------------
2022-07-14 21:03:38.975 INFO  com.song.kb.aspect.LogAspect                      :54   [32m202772028686733312[0;39m 请求地址: http://127.0.0.1:8081/category/all GET
2022-07-14 21:03:38.976 INFO  com.song.kb.aspect.LogAspect                      :54   [32m202772028686733313[0;39m 请求地址: http://127.0.0.1:8081/ebook-snapshot/get-30-statistic GET
2022-07-14 21:03:38.976 INFO  com.song.kb.aspect.LogAspect                      :55   [32m202772028686733312[0;39m 类名方法: com.song.kb.controller.CategoryController.all
2022-07-14 21:03:38.977 INFO  com.song.kb.aspect.LogAspect                      :54   [32m202772028695121920[0;39m 请求地址: http://127.0.0.1:8081/ebook-snapshot/get-statistic GET
2022-07-14 21:03:38.976 INFO  com.song.kb.aspect.LogAspect                      :55   [32m202772028686733313[0;39m 类名方法: com.song.kb.controller.EbookSnapshotController.get30Statistic
2022-07-14 21:03:38.977 INFO  com.song.kb.aspect.LogAspect                      :55   [32m202772028695121920[0;39m 类名方法: com.song.kb.controller.EbookSnapshotController.getStatistic
2022-07-14 21:03:38.977 INFO  com.song.kb.aspect.LogAspect                      :56   [32m202772028686733312[0;39m 远程地址: 127.0.0.1
2022-07-14 21:03:38.978 INFO  com.song.kb.aspect.LogAspect                      :56   [32m202772028695121920[0;39m 远程地址: 127.0.0.1
2022-07-14 21:03:38.978 INFO  com.song.kb.aspect.LogAspect                      :56   [32m202772028686733313[0;39m 远程地址: 127.0.0.1
2022-07-14 21:03:39.309 INFO  com.song.kb.aspect.LogAspect                      :78   [32m202772028686733312[0;39m 请求参数: []
2022-07-14 21:03:39.310 INFO  com.song.kb.aspect.LogAspect                      :78   [32m202772028686733313[0;39m 请求参数: []
2022-07-14 21:03:39.310 INFO  com.song.kb.aspect.LogAspect                      :78   [32m202772028695121920[0;39m 请求参数: []
2022-07-14 21:03:39.363 DEBUG c.s.k.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m202772028686733313[0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` between date_sub(curdate(), interval 30 day) and date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2022-07-14 21:03:39.365 DEBUG c.s.k.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m202772028686733313[0;39m ==> Parameters: 
2022-07-14 21:03:39.379 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getStatistic:137  [32m202772028695121920[0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2022-07-14 21:03:39.381 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getStatistic:137  [32m202772028695121920[0;39m ==> Parameters: 
2022-07-14 21:03:39.411 TRACE c.s.k.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m202772028686733313[0;39m <==    Columns: date, viewIncrease, voteIncrease
2022-07-14 21:03:39.412 TRACE c.s.k.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m202772028686733313[0;39m <==        Row: 2022-07-12, 103, 49
2022-07-14 21:03:39.414 TRACE c.s.kb.mapper.EbookSnapshotMapperCust.getStatistic:143  [32m202772028695121920[0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2022-07-14 21:03:39.415 TRACE c.s.kb.mapper.EbookSnapshotMapperCust.getStatistic:143  [32m202772028695121920[0;39m <==        Row: 2022-07-13, 114, 60, 11, 11
2022-07-14 21:03:39.419 TRACE c.s.kb.mapper.EbookSnapshotMapperCust.getStatistic:143  [32m202772028695121920[0;39m <==        Row: 2022-07-14, 128, 69, 14, 9
2022-07-14 21:03:39.418 TRACE c.s.k.m.EbookSnapshotMapperCust.get30Statistic    :143  [32m202772028686733313[0;39m <==        Row: 2022-07-13, 11, 11
2022-07-14 21:03:39.420 DEBUG c.s.k.m.EbookSnapshotMapperCust.get30Statistic    :137  [32m202772028686733313[0;39m <==      Total: 2
2022-07-14 21:03:39.420 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getStatistic:137  [32m202772028695121920[0;39m <==      Total: 2
2022-07-14 21:03:39.434 DEBUG com.song.kb.mapper.CategoryMapper.selectByExample :137  [32m202772028686733312[0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2022-07-14 21:03:39.437 DEBUG com.song.kb.mapper.CategoryMapper.selectByExample :137  [32m202772028686733312[0;39m ==> Parameters: 
2022-07-14 21:03:39.458 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==    Columns: id, parent, name, sort
2022-07-14 21:03:39.463 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 100, 0, 前端开发, 100
2022-07-14 21:03:39.467 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 101, 100, Vue, 101
2022-07-14 21:03:39.471 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 102, 100, HTML & CSS, 102
2022-07-14 21:03:39.476 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 200, 0, Java, 200
2022-07-14 21:03:39.478 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 201, 200, 基础应用, 201
2022-07-14 21:03:39.482 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 202, 200, 框架应用, 202
2022-07-14 21:03:39.484 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 300, 0, Python, 300
2022-07-14 21:03:39.490 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 301, 300, 基础应用, 301
2022-07-14 21:03:39.491 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 302, 300, 进阶方向应用, 302
2022-07-14 21:03:39.493 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 400, 0, 数据库, 400
2022-07-14 21:03:39.496 INFO  com.song.kb.aspect.LogAspect                      :90   [32m202772028695121920[0;39m 返回结果: {"content":[{"date":1657641600000,"viewCount":114,"viewIncrease":11,"voteCount":60,"voteIncrease":11},{"date":1657728000000,"viewCount":128,"viewIncrease":14,"voteCount":69,"voteIncrease":9}],"success":true}
2022-07-14 21:03:39.495 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 401, 400, MySQL, 401
2022-07-14 21:03:39.497 INFO  com.song.kb.aspect.LogAspect                      :91   [32m202772028695121920[0;39m ------------- 结束 耗时：534 ms -------------
2022-07-14 21:03:39.497 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 402, 400, NoSQL, 402
2022-07-14 21:03:39.501 INFO  com.song.kb.aspect.LogAspect                      :90   [32m202772028686733313[0;39m 返回结果: {"content":[{"date":1657555200000,"viewIncrease":103,"voteIncrease":49},{"date":1657641600000,"viewIncrease":11,"voteIncrease":11}],"success":true}
2022-07-14 21:03:39.502 INFO  com.song.kb.aspect.LogAspect                      :91   [32m202772028686733313[0;39m ------------- 结束 耗时：541 ms -------------
2022-07-14 21:03:39.503 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 403, 400, Oracle, 403
2022-07-14 21:03:39.505 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 500, 0, 其他, 500
2022-07-14 21:03:39.507 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 501, 500, 服务器, 501
2022-07-14 21:03:39.508 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 502, 500, 开发者工具, 502
2022-07-14 21:03:39.521 TRACE com.song.kb.mapper.CategoryMapper.selectByExample :143  [32m202772028686733312[0;39m <==        Row: 503, 500, 热门服务端语言, 503
2022-07-14 21:03:39.525 DEBUG com.song.kb.mapper.CategoryMapper.selectByExample :137  [32m202772028686733312[0;39m <==      Total: 17
2022-07-14 21:03:39.559 INFO  com.song.kb.aspect.LogAspect                      :90   [32m202772028686733312[0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"HTML & CSS","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":300,"name":"Python","parent":0,"sort":300},{"id":301,"name":"基础应用","parent":300,"sort":301},{"id":302,"name":"进阶方向应用","parent":300,"sort":302},{"id":400,"name":"数据库","parent":0,"sort":400},{"id":401,"name":"MySQL","parent":400,"sort":401},{"id":402,"name":"NoSQL","parent":400,"sort":402},{"id":403,"name":"Oracle","parent":400,"sort":403},{"id":500,"name":"其他","parent":0,"sort":500},{"id":501,"name":"服务器","parent":500,"sort":501},{"id":502,"name":"开发者工具","parent":500,"sort":502},{"id":503,"name":"热门服务端语言","parent":500,"sort":503}],"success":true}
2022-07-14 21:03:39.560 INFO  com.song.kb.aspect.LogAspect                      :91   [32m202772028686733312[0;39m ------------- 结束 耗时：600 ms -------------
2022-07-14 21:03:56.415 INFO  com.song.kb.websocket.WebSocketServer             :41   [32m                  [0;39m 连接关闭，token：uHqI4lhio1NM7ogeABKjIA9u，session id：0！当前连接数：0
2022-07-14 21:04:00.002 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202772116939083776[0;39m 生成今日电子书快照开始
2022-07-14 21:04:00.022 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772116939083776[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:04:00.025 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772116939083776[0;39m ==> Parameters: 
2022-07-14 21:04:00.071 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772116939083776[0;39m <==    Updates: 0
2022-07-14 21:04:00.073 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202772116939083776[0;39m 生成今日电子书快照结束，耗时：70毫秒
2022-07-14 21:04:05.004 INFO  com.song.kb.job.DocJob                            :32   [32m202772137918992384[0;39m 更新电子书下的文档数据开始
2022-07-14 21:04:05.026 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772137918992384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:04:05.028 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772137918992384[0;39m ==> Parameters: 
2022-07-14 21:04:05.063 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772137918992384[0;39m <==    Updates: 5
2022-07-14 21:04:05.064 INFO  com.song.kb.job.DocJob                            :35   [32m202772137918992384[0;39m 更新电子书下的文档数据结束，耗时：59毫秒
2022-07-14 21:04:35.025 INFO  com.song.kb.job.DocJob                            :32   [32m202772263748112384[0;39m 更新电子书下的文档数据开始
2022-07-14 21:04:35.152 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772263748112384[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:04:35.162 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772263748112384[0;39m ==> Parameters: 
2022-07-14 21:04:35.223 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772263748112384[0;39m <==    Updates: 5
2022-07-14 21:04:35.242 INFO  com.song.kb.job.DocJob                            :35   [32m202772263748112384[0;39m 更新电子书下的文档数据结束，耗时：141毫秒
2022-07-14 21:04:59.994 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202772368563769344[0;39m 生成今日电子书快照开始
2022-07-14 21:05:00.018 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772368563769344[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:05:00.023 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772368563769344[0;39m ==> Parameters: 
2022-07-14 21:05:00.059 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772368563769344[0;39m <==    Updates: 0
2022-07-14 21:05:00.059 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202772368563769344[0;39m 生成今日电子书快照结束，耗时：63毫秒
2022-07-14 21:05:04.992 INFO  com.song.kb.job.DocJob                            :32   [32m202772389526900736[0;39m 更新电子书下的文档数据开始
2022-07-14 21:05:05.013 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772389526900736[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:05:05.014 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772389526900736[0;39m ==> Parameters: 
2022-07-14 21:05:05.050 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772389526900736[0;39m <==    Updates: 5
2022-07-14 21:05:05.051 INFO  com.song.kb.job.DocJob                            :35   [32m202772389526900736[0;39m 更新电子书下的文档数据结束，耗时：58毫秒
2022-07-14 21:05:34.998 INFO  com.song.kb.job.DocJob                            :32   [32m202772515381186560[0;39m 更新电子书下的文档数据开始
2022-07-14 21:05:35.029 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772515381186560[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:05:35.030 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772515381186560[0;39m ==> Parameters: 
2022-07-14 21:05:35.065 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772515381186560[0;39m <==    Updates: 5
2022-07-14 21:05:35.066 INFO  com.song.kb.job.DocJob                            :35   [32m202772515381186560[0;39m 更新电子书下的文档数据结束，耗时：66毫秒
2022-07-14 21:05:59.998 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202772620238786560[0;39m 生成今日电子书快照开始
2022-07-14 21:06:00.022 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772620238786560[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:06:00.023 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772620238786560[0;39m ==> Parameters: 
2022-07-14 21:06:00.060 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772620238786560[0;39m <==    Updates: 0
2022-07-14 21:06:00.061 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202772620238786560[0;39m 生成今日电子书快照结束，耗时：59毫秒
2022-07-14 21:06:05.006 INFO  com.song.kb.job.DocJob                            :32   [32m202772641243860992[0;39m 更新电子书下的文档数据开始
2022-07-14 21:06:05.030 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772641243860992[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:06:05.031 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772641243860992[0;39m ==> Parameters: 
2022-07-14 21:06:05.066 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772641243860992[0;39m <==    Updates: 5
2022-07-14 21:06:05.068 INFO  com.song.kb.job.DocJob                            :35   [32m202772641243860992[0;39m 更新电子书下的文档数据结束，耗时：57毫秒
2022-07-14 21:06:35.005 INFO  com.song.kb.job.DocJob                            :32   [32m202772767068786688[0;39m 更新电子书下的文档数据开始
2022-07-14 21:06:35.025 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772767068786688[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:06:35.026 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772767068786688[0;39m ==> Parameters: 
2022-07-14 21:06:35.061 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772767068786688[0;39m <==    Updates: 5
2022-07-14 21:06:35.061 INFO  com.song.kb.job.DocJob                            :35   [32m202772767068786688[0;39m 更新电子书下的文档数据结束，耗时：54毫秒
2022-07-14 21:07:00.006 INFO  com.song.kb.job.EbookSnapshotJob                  :33   [32m202772871930580992[0;39m 生成今日电子书快照开始
2022-07-14 21:07:00.027 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772871930580992[0;39m ==>  Preparing: insert into `ebook_snapshot`(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists(select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); # 更新总阅读数、总点赞数 update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.ebook_id = t2.id and t1.`date` = curdate(); # 更新今日阅读数，今日点赞数 update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = (t1.view_count - ifnull(t2.view_count, 0)), t1.vote_increase = (t1.vote_count - ifnull(t2.vote_count, 0)) where t1.`date` = curdate();
2022-07-14 21:07:00.028 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772871930580992[0;39m ==> Parameters: 
2022-07-14 21:07:00.063 DEBUG c.s.kb.mapper.EbookSnapshotMapperCust.getSnapshot :137  [32m202772871930580992[0;39m <==    Updates: 0
2022-07-14 21:07:00.065 INFO  com.song.kb.job.EbookSnapshotJob                  :36   [32m202772871930580992[0;39m 生成今日电子书快照结束，耗时：56毫秒
2022-07-14 21:07:05.001 INFO  com.song.kb.job.DocJob                            :32   [32m202772892881129472[0;39m 更新电子书下的文档数据开始
2022-07-14 21:07:05.020 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772892881129472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:07:05.021 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772892881129472[0;39m ==> Parameters: 
2022-07-14 21:07:05.056 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202772892881129472[0;39m <==    Updates: 5
2022-07-14 21:07:05.057 INFO  com.song.kb.job.DocJob                            :35   [32m202772892881129472[0;39m 更新电子书下的文档数据结束，耗时：54毫秒
2022-07-14 21:07:35.001 INFO  com.song.kb.job.DocJob                            :32   [32m202773018710249472[0;39m 更新电子书下的文档数据开始
2022-07-14 21:07:35.020 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202773018710249472[0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2022-07-14 21:07:35.022 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202773018710249472[0;39m ==> Parameters: 
2022-07-14 21:07:35.056 DEBUG com.song.kb.mapper.DocMapperCust.updateEbookInfo  :137  [32m202773018710249472[0;39m <==    Updates: 5
2022-07-14 21:07:35.057 INFO  com.song.kb.job.DocJob                            :35   [32m202773018710249472[0;39m 更新电子书下的文档数据结束，耗时：54毫秒
